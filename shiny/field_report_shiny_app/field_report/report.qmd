---
title: "Report"
date: sys.date
format: html
params:
  collector: NA
  rundate: NA
  runcode: NA
  sitecode: NA
---

::: panel-tabset
## Site Information

```         
# UI for first tab, includes information tables
site_data <- sitecode()

# Reactivity to split the tables by run date, run code, and site code
tables_by_date <- lapply(split(site_data, site_data$RunDate), function(date_df) {
  date <- unique(date_df$RunDate)
  date_tables <- lapply(split(date_df, date_df$RunCode), function(run_df) {
    run_code <- unique(run_df$RunCode)
    run_tables <- lapply(split(run_df, run_df$SiteCode), function(site_df) {
      site_code <- unique(site_df$SiteCode)

      # Site Info Table
      si_table <- site_df %>%
        dplyr::select(RunCode, SiteCode, WaterBody, SiteVisitStartTime, SiteDepth) %>% # It's really important to specify that select is from the dplyr package, otherwise it won't work
        rename(
          "Water Body" = "WaterBody",
          "Site" = "SiteCode",
          "Run Code" = "RunCode",
          "Time" = "SiteVisitStartTime",
          "Depth" = "SiteDepth"
        ) %>%
        distinct() %>%
        gt() %>%
        cols_align(align = "center") %>%
        tab_header(title = glue("Site Information: {site_code}")) %>%
        tab_style(
          style = cell_borders(
            sides = c("all"),
            color = "black",
            weight = px(1),
            style = "solid"
          ),
          locations = list(cells_body(), cells_column_labels())
        )

      # Abiotic Factors Table
      af_table <- site_df %>%
        dplyr::select(SiteCode, Weather, SamplingAirTemp, RivCond, WaterLevel, FoamRank, FoamSource) %>%
        rename(
          "Air Temp" = "SamplingAirTemp",
          "River Cond" = "RivCond",
          "Water Level" = "WaterLevel",
          "Foam Rank" = "FoamRank",
          "Foam Source" = "FoamSource",
          "Site" = "SiteCode"
        ) %>%
        distinct() %>%
        gt() %>%
        cols_align(align = "center") %>%
        tab_header(title = glue("Abiotic Factors: {site_code}")) %>%
        tab_style(
          style = cell_borders(
            sides = c("all"),
            color = "black",
            weight = px(1),
            style = "solid"
          ),
          locations = list(cells_body(), cells_column_labels())
        )

      # Notes Table
      notes_table <- site_df %>%
        dplyr::select(SiteCode, SiteVisitComment) %>%
        rename(
          "Site Visit Notes" = "SiteVisitComment",
          "Site" = "SiteCode"
        ) %>%
        distinct() %>%
        gt() %>%
        cols_align(align = "center") %>%
        tab_header(title = glue("Site Visit Notes: {site_code}")) %>%
        tab_style(
          style = cell_borders(
            sides = c("all"),
            color = "black",
            weight = px(1),
            style = "solid"
          ),
          locations = list(cells_body(), cells_column_labels())
        )

      tagList(
        div(style = "margin-bottom: 20px;", si_table, af_table, notes_table)
      )
    })
    # Creates run code heading
    tagList(
      h3(glue("Run Code: {run_code}")),
      run_tables
    )
  })
  # Creates date heading
  tagList(
    h2(glue("Date: {date}")),
    date_tables
  )
})

tagList(tables_by_date)
```

## Samples

## Measurements
:::
