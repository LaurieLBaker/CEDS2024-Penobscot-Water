---
title: "Water Quality Report Template"
format: html
editor: visual
execute:
  echo: false
---

```{r install.packages, include=FALSE}
library(tidyverse)
library(quarto)
library(dplyr)
library(devtools)
library(readr)
library(gt) #for tables
library(htmltools)
```

```{r load_data}
data2018 <- readRDS("~/Repos/Penobscot-Water/data/PINCommEngData.RData")
```

## Site Visit Information {.smaller}

Option of a table format

```{r site_info_tables}
site_info1 <- data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  select(SiteVisitID, RunCode, RunDate, WaterBody, SiteCode, SiteVisitStartTime, SiteDepth) %>%
  distinct() %>% 
  gt() %>%
  cols_align(align = "center") %>% 
  tab_header(title = "Site information") #for the combined tables
site_info1

site_info2 <-data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  select(SamplingAirTemp, Weather, RivCond, WaterLevel, FoamRank, FoamSource, SiteVisitComment) %>% 
  distinct() %>% 
  gt() %>%
  cols_align(align = "center")
site_info2
```

or a more similar template as in the previous reports

```{r site_infromation_tibble}
#| label: tbl-site-visit-information
#| tbl-cap: Site Visit Information Table

site_visit_information <- data2018 %>% 
  select(SiteVisitID, RunCode, RunDate, WaterBody, SiteCode, SiteVisitStartTime, SiteDepth, SamplingAirTemp, Weather, RivCond, WaterLevel, FoamRank, FoamSource, SiteVisitComment) %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  distinct()
#glimpse(site_visit_information)

cat("```\n")
cat(paste("SiteVisitID: ", site_visit_information$SiteVisitID, " | RunCode: ", site_visit_information$RunCode, " | RunDate: ", site_visit_information$RunDate, "\n"))
cat(paste("WaterBody: ", site_visit_information$WaterBody, " | SiteCode: ", site_visit_information$SiteCode, " | SiteVisitStartTime: ", site_visit_information$SiteVisitStartTime, "\n"))
cat(paste("SiteDepth: ", site_visit_information$SiteDepth, " | SamplingAirTemp: ", site_visit_information$SamplingAirTemp, " | Weather: ", site_visit_information$Weather," | RivCond: ", site_visit_information$RivCond, "\n"))
cat(paste("WaterLevel: ", site_visit_information$WaterLevel, " | FoamRank: ", site_visit_information$FoamRank," | FoamSource: ", site_visit_information$FoamSource,  "\n"))
cat(paste("SiteVisitComment: ", site_visit_information$SiteVisitComment, "\n"))
cat("```\n")
```

## Sample Table

Option of 3 separate tables

```{r HETL_sample_table}
#| label: tbl-sample_HETL
#| tbl-cap: HETL Sample Table

data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  filter(LabAbbrev == "HETL") %>% 
  select(SampleName, ProjectCode, CntrType, QCType, CollMethod, SampleDepth) %>% 
  distinct() %>% #removes all the row that are the same, unsure if we are keeping them
  gt() %>%
  cols_align(align = "center")
```

```{r Msmt_sample_table}
#| label: tbl-sample_Msmt
#| tbl-cap: Msmt Sample Table

data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  filter(LabAbbrev == "Msmt") %>% 
  select(SampleName, ProjectCode, CntrType, QCType, CollMethod, SampleDepth) %>% 
  distinct() %>% #removes all the row that are the same, unsure if we are keeping them
  gt() %>%
  cols_align(align = "center")
```

```{r PIN_sample_table}
#| label: tbl-sample_PIN
#| tbl-cap: PIN Sample Table

data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  filter(LabAbbrev == "PIN") %>% 
  select(SampleName, ProjectCode, CntrType, QCType, CollMethod, SampleDepth) %>% 
  distinct() %>% #removes all the row that are the same, unsure if we are keeping them
  gt() %>%
  cols_align(align = "center")
```

Or one big table

```{r sample_table}
#| label: tbl-sample
#| tbl-cap: Sample Table
sample_table <- data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  select(SampleName, ProjectCode, CntrType, QCType, CollMethod, SampleDepth, LabAbbrev) %>% 
  group_by(LabAbbrev) %>% 
  distinct() %>% #removes all the row that are the same, unsure if we are keeping them
  gt() %>%
  cols_align(align = "center") %>% 
  tab_header(title = "Sample Table")
sample_table
```

## Filter Table

```{r fitler_table}
#| label: tbl-filter
#| tbl-cap: Filter Table

filter_table <- data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  select(SampleName, SampleFilterMethod) %>% 
  distinct() %>%
  gt() %>%
  cols_align(align = "center") %>% 
  tab_header(title = "Filter Table")
```

## Result Table

```{r result_table}
#| label: tbl-results
#| tbl-cap: Results Table

result_table <- data2018 %>% 
  filter(SiteVisitID == "JasonS7-2018924111226") %>% 
  select(SampleName, ProfileDepth, Const, Result) %>% 
  group_by(Const) %>% 
  distinct() %>%
  gt() %>%
  cols_align(align = "center") %>% 
  tab_header(title = "Result Table")
```

## Controls Summary

To add a list/table of the flags that were checked and highlighted during the process

## Template Similar to Other Reports {style="table"}

```{r combined_tables}
combined_tables <- div(
  style = "display: flex; flex-direction: column; gap: 10px; align-items: center;",
  site_info1, site_info2,
  div(style = "display: flex; gap: 10px; width: 100%;",
      div(style = "flex: 1;", result_table),
      div(style = "flex: 1; display: flex; flex-direction: column; gap: 10px;",
          sample_table,
          filter_table)))
combined_tables
```
