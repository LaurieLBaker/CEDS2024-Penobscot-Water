quarto publish quarto-pub---
title: "Lab Report test"
date: today
format:
  html:
    embed-resources: true
    number_sections: true
    toc: true 
    toc-location: left
    page-layout: full
  pdf: default
format-links: false
execute:
  echo: false
  warning: false
params:
  individual_collector: "DHK"
  SiteVisitID: current_SiteVisitID
  RunCode: current_RunCode
  RunDate: current_RunDate
  SiteCode: current_SiteCode
---

Collector: **`r params$individual_collector`**

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
library(readr)
library(here)
library(dplyr)
library(ggplot2)
library(stringr)
library(purrr)
library(htmltools)
library(knitr)
library(gt)
library(kableExtra)
library(tidyr)
library(lubridate)

data2018 <- readRDS("data/PINCommEngData (2).RData")

data2018 <-  data2018 %>%
  mutate(RunDate = format(as.Date(RunDate), "%m-%d-%Y")) 
```

```{r}
#| results: hide

unique_collectors <- unique(data2018$Collectors)

split_collectors <- strsplit(unique_collectors, ";")

individual_values <- unlist(split_collectors)

individual_values <- gsub("\\s+", "", individual_values)

individual_collectors <- unique(individual_values) 

data2018_subset <- data2018 %>% filter(str_detect(Collectors, fixed(params$individual_collector)))

data2018_subset <- data2018_subset %>%
  arrange(SiteVisitID)


SiteVisitID <- data2018_subset %>% 
  filter(str_detect(Collectors, fixed(params$individual_collector))) |> 
  distinct(SiteVisitID) %>% 
  pull()

RunDate <- data2018_subset %>% 
  filter(str_detect(Collectors, fixed(params$individual_collector))) |> 
  distinct(RunDate) %>% 
  pull()

RunCode <- data2018_subset %>%
  filter(str_detect(Collectors, fixed(params$individual_collector))) |> 
  distinct(RunCode) %>% 
  pull()

SiteCode <- data2018_subset %>%
  filter(str_detect(Collectors, fixed(params$individual_collector))) |> 
  distinct(SiteCode) %>% 
  pull()
```


```{r}
#| output: asis


SiteVisitID_Sections_lab <- map_chr(SiteVisitID, \(current_SiteVisitID) {

current_RunDate <- data2018_subset[data2018_subset$SiteVisitID == current_SiteVisitID, "RunDate"] %>%
distinct() %>% pull()
current_RunCode <- data2018_subset[data2018_subset$SiteVisitID == current_SiteVisitID, "RunCode"] %>%
distinct() %>% pull()
current_SiteCode <- data2018_subset[data2018_subset$SiteVisitID == current_SiteVisitID, "SiteCode"] %>% distinct() %>% pull()

{
params <- (RunDate = current_RunDate)
params <- (RunCode = current_RunCode)
params <- (SiteCode = current_SiteCode)
knitr::knit_child(
input = "Child_Doc_Lab_Report_Template.qmd",
envir = rlang::env(),
quiet = TRUE
)
}
})


cat(SiteVisitID_Sections_lab, sep = "\n")

```